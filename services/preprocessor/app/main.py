from app.worker import process_logs

if __name__ == "__main__":
    raw_log = """Started by user unknown or anonymous\nObtained Jenkinsfile from git https://github.com/anvitha-rao10/agentic-ai-devops\n[Pipeline] Start of Pipeline\n[Pipeline] node\nRunning on Jenkins in /var/jenkins_home/workspace/agentic-ai-devops-pipeline\n[Pipeline] {\n[Pipeline] stage\n[Pipeline] { (Declarative: Checkout SCM)\n[Pipeline] checkout\nSelected Git installation does not exist. Using Default\nThe recommended git tool is: NONE\nWarning: CredentialId \"github-ssh-key\" could not be found.\n \u003E git rev-parse --resolve-git-dir /var/jenkins_home/workspace/agentic-ai-devops-pipeline/.git # timeout=10\nFetching changes from the remote Git repository\n \u003E git config remote.origin.url https://github.com/anvitha-rao10/agentic-ai-devops # timeout=10\nFetching upstream changes from https://github.com/anvitha-rao10/agentic-ai-devops\n \u003E git --version # timeout=10\n \u003E git --version # 'git version 2.47.3'\n \u003E git fetch --tags --force --progress -- https://github.com/anvitha-rao10/agentic-ai-devops +refs/heads/*:refs/remotes/origin/* # timeout=10\n \u003E git rev-parse refs/remotes/origin/main^{commit} # timeout=10\nChecking out Revision c6981d059505c1cb6189c51326d5c795609070d4 (refs/remotes/origin/main)\n \u003E git config core.sparsecheckout # timeout=10\n \u003E git checkout -f c6981d059505c1cb6189c51326d5c795609070d4 # timeout=10\nCommit message: \"Collector API\"\n \u003E git rev-list --no-walk 7f0361f237e7586ba4a3728644e0eb83ff93ef7b # timeout=10\n[Pipeline] }\n[Pipeline] // stage\n[Pipeline] withEnv\n[Pipeline] {\n[Pipeline] stage\n[Pipeline] { (Checkout Code (SSH))\n[Pipeline] git\nSelected Git installation does not exist. Using Default\nThe recommended git tool is: NONE\nWarning: CredentialId \"github-ssh-key\" could not be found.\n \u003E git rev-parse --resolve-git-dir /var/jenkins_home/workspace/agentic-ai-devops-pipeline/.git # timeout=10\nFetching changes from the remote Git repository\n \u003E git config remote.origin.url git@github.com:anvitha-rao10/agentic-ai-devops.git # timeout=10\nFetching upstream changes from git@github.com:anvitha-rao10/agentic-ai-devops.git\n \u003E git --version # timeout=10\n \u003E git --version # 'git version 2.47.3'\n \u003E git fetch --tags --force --progress -- git@github.com:anvitha-rao10/agentic-ai-devops.git +refs/heads/*:refs/remotes/origin/* # timeout=10\nERROR: Error fetching remote repo 'origin'\nhudson.plugins.git.GitException: Failed to fetch from git@github.com:anvitha-rao10/agentic-ai-devops.git\n\tat PluginClassLoader for git//hudson.plugins.git.GitSCM.fetchFrom(GitSCM.java:998)\n\tat PluginClassLoader for git//hudson.plugins.git.GitSCM.retrieveChanges(GitSCM.java:1239)\n\tat PluginClassLoader for git//hudson.plugins.git.GitSCM._checkout(GitSCM.java:1310)\n\tat PluginClassLoader for git//hudson.plugins.git.GitSCM.checkout(GitSCM.java:1277)\n\tat PluginClassLoader for workflow-scm-step//org.jenkinsci.plugins.workflow.steps.scm.SCMStep.checkout(SCMStep.java:136)\n\tat PluginClassLoader for workflow-scm-step//org.jenkinsci.plugins.workflow.steps.scm.SCMStep$StepExecutionImpl.run(SCMStep.java:101)\n\tat PluginClassLoader for workflow-scm-step//org.jenkinsci.plugins.workflow.steps.scm.SCMStep$StepExecutionImpl.run(SCMStep.java:88)\n\tat PluginClassLoader for workflow-step-api//org.jenkinsci.plugins.workflow.steps.SynchronousNonBlockingStepExecution.lambda$start$0(SynchronousNonBlockingStepExecution.java:49)\n\tat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Unknown Source)\n\tat java.base/java.util.concurrent.FutureTask.run(Unknown Source)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\n\tat java.base/java.lang.Thread.run(Unknown Source)\nCaused by: hudson.plugins.git.GitException: Command \"git fetch --tags --force --progress -- git@github.com:anvitha-rao10/agentic-ai-devops.git +refs/heads/*:refs/remotes/origin/*\" returned status code 128:\nstdout: \nstderr: git@github.com: Permission denied (publickey).\r\nfatal: Could not read from remote repository.\n\nPlease make sure you have the correct access rights\nand the repository exists.\n\n\tat PluginClassLoader for git-client//org.jenkinsci.plugins.gitclient.CliGitAPIImpl.launchCommandIn(CliGitAPIImpl.java:2861)\n\tat PluginClassLoader for git-client//org.jenkinsci.plugins.gitclient.CliGitAPIImpl.launchCommandWithCredentials(CliGitAPIImpl.java:2201)\n\tat PluginClassLoader for git-client//org.jenkinsci.plugins.gitclient.CliGitAPIImpl$1.execute(CliGitAPIImpl.java:638)\n\tat PluginClassLoader for git//hudson.plugins.git.GitSCM.fetchFrom(GitSCM.java:996)\n\t... 12 more\nERROR: Error fetching remote repo 'origin'\nERROR: Maximum checkout retry attempts reached, aborting\n[Pipeline] }\n[Pipeline] // stage\n[Pipeline] stage\n[Pipeline] { (Verify)\nStage \"Verify\" skipped due to earlier failure(s)\n[Pipeline] getContext\n[Pipeline] }\n[Pipeline] // stage\n[Pipeline] }\n[Pipeline] // withEnv\n[Pipeline] }\n[Pipeline] // node\n[Pipeline] End of Pipeline\nERROR: Error fetching remote repo 'origin'\nFinished: FAILURE\n"""
    logs = raw_log.splitlines()

    results = process_logs(
        job_name="agentic-ai-devops-pipeline",
        build_id="70",
        logs=logs
    )

    print("\n--- SSH ERROR LINES ---\n")
    for line in results:
        print(line)
